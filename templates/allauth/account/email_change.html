{% extends "base.html" %}
{% load i18n %}
{% load allauth %}

{% block head_title %}
    {% trans "Email Address" %}
{% endblock head_title %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow-lg p-4 auth-card text-center">
        <h1 class="logo-font text-primary">
            <i class="fas fa-envelope"></i> {% trans "Manage Email Address" %}
        </h1>

        {% if not emailaddresses %}
            {% include "account/snippets/warn_no_email.html" %}
        {% endif %}

        {% url 'account_email' as action_url %}
        <form method="post" action="{{ action_url }}" class="mt-4">
            {% csrf_token %}

            {% if current_emailaddress %}
                <div class="form-group">
                    <label for="current_email"><strong>{% translate "Current Email" %}:</strong></label>
                    <input type="email" id="current_email" class="form-control" value="{{ current_emailaddress.email }}" disabled>
                </div>
            {% endif %}

            {% if new_emailaddress %}
                <div class="form-group">
                    <label for="new_email">
                        <strong>{% if not current_emailaddress %}
                            {% translate "Current email" %}
                        {% else %}
                            {% translate "Changing to" %}
                        {% endif %}:</strong>
                    </label>
                    <input type="email" id="new_email" class="form-control" value="{{ new_emailaddress.email }}" disabled>
                    <small class="text-muted d-block mt-1">
                        {% blocktranslate %}Your email address is still pending verification.{% endblocktranslate %}
                    </small>
                    <button form="pending-email" type="submit" name="action_send" class="btn btn-outline-primary btn-sm mt-2">
                        <i class="fas fa-redo"></i> {% trans 'Re-send Verification' %}
                    </button>
                    {% if current_emailaddress %}
                        <button form="pending-email" type="submit" name="action_remove" class="btn btn-outline-danger btn-sm mt-2">
                            <i class="fas fa-times"></i> {% trans 'Cancel Change' %}
                        </button>
                    {% endif %}
                </div>
            {% endif %}

            <div class="form-group">
                <label for="{{ form.email.auto_id }}"><strong>{% translate "Change to" %}:</strong></label>
                <input type="email" name="email" id="{{ form.email.auto_id }}" class="form-control" value="{{ form.email.value }}">
                {% if form.email.errors %}
                    <div class="text-danger mt-1">
                        {{ form.email.errors }}
                    </div>
                {% endif %}
            </div>

            <button name="action_add" type="submit" class="btn btn-primary btn-block mt-3">
                <i class="fas fa-edit"></i> {% trans "Change Email" %}
            </button>
        </form>

        {% if new_emailaddress %}
            <form style="display: none" id="pending-email" method="post" action="{% url 'account_email' %}">
                {% csrf_token %}
                <input type="hidden" name="email" value="{{ new_emailaddress.email }}">
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}
