{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid overlay">

    <!-- Category Heading -->
    {% if category_name %}
        <div class="row text-center py-3 bg-warning text-dark">
            <div class="col">
                <h2 class="display-5 font-weight-bold">Showing Products in Category: {{ category_name|title }}</h2>
            </div>
        </div>
    {% endif %}
    
    <!-- Red Banner -->
    <div class="row text-center py-5 bg-danger text-white">
        <div class="col">
            <h1 class="logo-font display-4 font-weight-bold">Explore Our Brick Collection</h1>
            <p class="lead">Discover sets from your favourite themes, ready to build.</p>

            <!-- Filters and Sorting -->
            <form method="get" action="{% url 'all_products' %}" class="form-inline justify-content-center mt-4">
                <!-- Filter by Difficulty -->
                <div class="form-group mx-2">
                    <select name="difficulty" class="form-control bg-dark text-white">
                        <option value="">Filter by Difficulty</option>
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Expert">Expert</option>
                    </select>
                </div>

                <!-- Filter by Theme -->
                <div class="form-group mx-2">
                    <select name="theme" class="form-control bg-dark text-white">
                        <option value="">Filter by Theme</option>
                        {% for theme in valid_themes %}
                        <option value="{{ theme }}">{{ theme }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Sort By -->
                <div class="form-group mx-2">
                    <select name="sort_by" class="form-control bg-dark text-white">
                        <option value="">Sort By</option>
                        <option value="price">Price</option>
                        <option value="alphabetical">Alphabetically</option>
                        <option value="difficulty">Difficulty</option>
                        <option value="rating">Rating</option>
                    </select>
                </div>

                <!-- Apply and Clear Filters -->
                <button type="submit" class="btn btn-warning mx-2">Apply</button>
                <a href="{% url 'all_products' %}" class="btn btn-warning mx-2">Clear Filters</a>
            </form>
        </div>
    </div>


    <!-- Products Section -->
    <div class="row mt-5">
        {% if products %}
            {% for product in products %}
                <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                    <div class="card h-100">
                        <!-- Wrap the image in a link to the product detail page -->
                        <a href="{% url 'product_detail' product.id %}">
                            <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}">
                        </a>
                        <div class="card-body">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text">â‚¬{{ product.price }}</p>
                        </div>
                        <div class="card-footer">
                            <small class="text-muted">Rating: {{ product.rating }}</small>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-center mt-5">No products found matching your filters. Try adjusting the filters or clearing them.</p>
        {% endif %}
    </div>
{% endblock %}
